<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>原生实现spa</title>
    <script src="./history.js"></script>
  </head>
  <style>
    .nav__item {
      display: inline-block;
      text-decoration: underline;
      cursor: pointer;
    }
    .nav__item--active {
      color: red;
    }
    .container {
      margin-top: 20px;
      padding: 20px;
    }
  </style>
  <body>
    <div id="app">
      <div class="nav">
        <div class="nav__item" data-link="/A">页面A</div>
        <div class="nav__item" data-link="/B">页面B</div>
      </div>
      <div class="container"></div>
    </div>
    <script>
      var containerDom = document.querySelector(".container");
      var contentMap = {
        "/A": "页面A的内容",
        "/B": "页面B的内容"
      };
      var defaultPath = "/A";
      var links = document.querySelectorAll("[data-link]");
      var myHistory = History.createBrowserHistory();

      // 监听url变动
      myHistory.listen((location, action) => {
        console.log(location, action);
        changeHtmlByPath(location.pathname);
      });

      // url变化时修改html
      [...links].forEach(el => {
        el.addEventListener("click", () => {
          let path = el.getAttribute("data-link");
          myHistory.push(path);
          changeHtmlByPath(path);
        });
      });

      // init
      let path = myHistory.location.pathname;
      if (!path || path == "/") {
        path = defaultPath;
      }
      changeHtmlByPath(path);

      function changeHtmlByPath(path) {
        if (!path || path == "/") {
          path = defaultPath;
        }
        let content = contentMap[path];
        let navactiveDom = document.querySelector(".nav__item--active");
        navactiveDom && navactiveDom.classList.remove("nav__item--active");
        document
          .querySelector(`[data-link="${path}"]`)
          .classList.add("nav__item--active");
        containerDom.innerHTML = content;
      }
    </script>
  </body>
</html>
